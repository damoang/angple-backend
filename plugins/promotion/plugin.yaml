# 직접홍보 게시판 플러그인
# Direct Promotion Board Plugin

name: promotion
version: 1.0.0
title: 직접홍보 게시판
description: 광고주가 직접 홍보 게시글을 작성하고, 다른 게시판에 사잇광고로 삽입되는 시스템
author: Damoang Team
license: MIT
homepage: https://github.com/damoang/angple-backend

# 호환성
requires:
  angple: ">=1.0.0 <2.0.0"
  go: ">=1.21"

# DB 마이그레이션
migrations:
  - file: 001_init.up.sql
    version: 1

# Hook 등록
hooks:
  - event: post.list
    handler: InsertPromotionPosts
    priority: 10
    description: 게시판 목록에 사잇광고 삽입

  - event: admin.menu
    handler: AddAdminMenu
    priority: 50
    description: 관리자 메뉴에 직홍게 관리 추가

  - event: template.sidebar
    handler: AddSidebarWidget
    priority: 10
    description: 사이드바에 직홍게 최신글 위젯 추가

# API 라우트
routes:
  # 공개 API
  - path: /posts
    method: GET
    handler: ListPosts
    auth: none
    description: 직홍게 글 목록

  - path: /posts/insert
    method: GET
    handler: GetPostsForInsert
    auth: none
    description: 사잇광고용 글 조회

  - path: /posts/:id
    method: GET
    handler: GetPost
    auth: none
    description: 직홍게 글 상세

  # 광고주 전용 API
  - path: /posts
    method: POST
    handler: CreatePost
    auth: required
    description: 직홍게 글 작성 (광고주만)

  - path: /posts/:id
    method: PUT
    handler: UpdatePost
    auth: required
    description: 직홍게 글 수정

  - path: /posts/:id
    method: DELETE
    handler: DeletePost
    auth: required
    description: 직홍게 글 삭제

  # 관리자 API
  - path: /admin/advertisers
    method: GET
    handler: ListAdvertisers
    auth: required
    description: 광고주 목록

  - path: /admin/advertisers
    method: POST
    handler: CreateAdvertiser
    auth: required
    description: 광고주 추가

  - path: /admin/advertisers/:id
    method: PUT
    handler: UpdateAdvertiser
    auth: required
    description: 광고주 수정

  - path: /admin/advertisers/:id
    method: DELETE
    handler: DeleteAdvertiser
    auth: required
    description: 광고주 삭제

# 설정 스키마 (관리자 UI 자동 생성)
settings:
  - key: insert_position
    type: number
    default: 3
    min: 1
    max: 20
    label: 사잇광고 삽입 위치
    description: 게시판 목록에서 사잇광고가 삽입될 위치

  - key: insert_count
    type: number
    default: 1
    min: 1
    max: 5
    label: 사잇광고 개수
    description: 한 페이지에 삽입될 사잇광고 개수

  - key: exclude_boards
    type: textarea
    default: "promotion,promotion_my,notice"
    label: 제외 게시판
    description: 사잇광고를 표시하지 않을 게시판 ID (쉼표로 구분)

  - key: sidebar_widget_count
    type: number
    default: 5
    min: 1
    max: 10
    label: 사이드바 위젯 글 수
    description: 사이드바 위젯에 표시할 최신글 개수

# 권한 정의
permissions:
  - id: promotion.manage
    label: 직홍게 관리
    description: 광고주 및 직홍게 글 관리 권한

# 프론트엔드 슬롯
slots:
  - name: post.before_title
    component: web/components/PromotionBadge.svelte
    props: [post]
    description: 직홍게 글에 AD 뱃지 표시

  - name: global.sidebar
    component: web/components/PromotionWidget.svelte
    props: [user]
    description: 사이드바 직홍게 최신글 위젯
